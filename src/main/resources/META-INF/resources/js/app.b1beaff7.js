(function(e){function t(t){for(var s,o,a=t[0],l=t[1],c=t[2],d=0,u=[];d<a.length;d++)o=a[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&u.push(r[o][0]),r[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);m&&m(t);while(u.length)u.shift()();return n.push.apply(n,c||[]),i()}function i(){for(var e,t=0;t<n.length;t++){for(var i=n[t],s=!0,a=1;a<i.length;a++){var l=i[a];0!==r[l]&&(s=!1)}s&&(n.splice(t--,1),e=o(o.s=i[0]))}return e}var s={},r={app:0},n=[];function o(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=s,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(i,s,function(t){return e[t]}.bind(null,s));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var m=l;n.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"04be":function(e,t,i){},"0c5f":function(e,t,i){"use strict";i("8bb8")},"0d00":function(e,t,i){},"0fee":function(e,t,i){},"1d4b":function(e,t,i){"use strict";i("0fee")},"4dcb":function(e,t,i){"use strict";i("04be")},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var s=i("2b0e"),r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-app",[i("transition",[i("keep-alive",{attrs:{include:"Home"}},[i("router-view")],1)],1)],1)},n=[],o=(i("5c0b"),i("2877")),a=i("6544"),l=i.n(a),c=i("7496"),m={},d=Object(o["a"])(m,r,n,!1,null,null,null),u=d.exports;l()(d,{VApp:c["a"]});var p=i("f309");s["a"].use(p["a"]);var f=new p["a"]({theme:{dark:!0}}),v=i("8c4f"),h=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-app-bar",{attrs:{app:"",dark:""}},[i("v-toolbar-title",[e._v("Options")]),e.loading?i("v-progress-circular",{staticClass:"load-progress",attrs:{width:3,size:20,indeterminate:"",color:"primary"}}):e._e(),i("v-spacer"),i("v-btn",{attrs:{icon:""},on:{click:e.close}},[i("v-icon",[e._v("mdi-close")])],1)],1),i("v-main",[i("v-card",{attrs:{flat:"",tile:""}},[i("v-container",[i("v-alert",{attrs:{color:"red",dismissible:"",elevation:"2",type:"error"},model:{value:e.error.visible,callback:function(t){e.$set(e.error,"visible",t)},expression:"error.visible"}},[e._v(e._s(e.error.message))])],1)],1),i("v-card",{attrs:{flat:"",tile:""}},[i("v-container",[i("v-file-input",{attrs:{label:"CSV File",accept:".csv"},model:{value:e.uploadForm.file,callback:function(t){e.$set(e.uploadForm,"file",t)},expression:"uploadForm.file"}}),i("v-text-field",{attrs:{label:"Tags for all items","prepend-icon":"mdi-tag"},model:{value:e.uploadForm.tags,callback:function(t){e.$set(e.uploadForm,"tags",t)},expression:"uploadForm.tags"}}),i("v-btn",{attrs:{elevation:"2"},on:{click:e.upload}},[e._v("Import CSV "),i("v-icon",{attrs:{right:""}},[e._v("mdi-cloud-upload")])],1)],1)],1),i("v-divider"),i("v-card",{attrs:{flat:"",tile:""}},[i("v-container",[i("v-btn",{attrs:{elevation:"2"},on:{click:e.permissions}},[e._v("Permissions "),i("v-icon",{attrs:{right:""}},[e._v("mdi-lock")])],1)],1)],1),i("v-divider"),i("v-card",{attrs:{flat:"",tile:""}},[i("v-container",[i("v-btn",{attrs:{elevation:"2"},on:{click:e.logout}},[e._v("Logout "),i("v-icon",{attrs:{right:""}},[e._v("mdi-logout")])],1)],1)],1)],1)],1)},g=[],b=i("d4ec"),y=i("bee2"),x=(i("a15b"),i("d81d"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),function(){function e(){Object(b["a"])(this,e)}return Object(y["a"])(e,null,[{key:"fillItemRawContent",value:function(e){var t=e.title+" "+e.url+" "+e.image+" "+e.notes+" "+this.getTagsString(e)+" "+e.score;e.rawContent=t.toLowerCase()}},{key:"fillPermissionRawContent",value:function(e){e.rawContent=this.getTagsString(e)+" "+e.usernames.join(" ")}},{key:"getTagsString",value:function(e){return e.tags?e.tags.map((function(e){return"#"+e+" "})).join(""):""}},{key:"buildShareLink",value:function(e,t){e.sort();var i=new URL(location.href);return i.protocol+"//"+i.host+"/?user="+t.credentials.username+"&tags="+e.join(",")}},{key:"colorFromScore",value:function(e){return e<10?"red darken-2":e<20?"deep-orange darken-2":e<30?"orange darken-3":e<40?"amber darken-3":e<50?"yellow darken-3":e<60?"grey darken-3":e<70?"blue":e<80?"cyan":e<90?"teal":"green"}},{key:"messageFromApiError",value:function(e){return console.error("API Error",e.response.data,e),e.response.data?e.response.data:e}},{key:"messageObjectFromApiError",value:function(e){return{message:this.messageFromApiError(e),visible:!0}}},{key:"loadWithAxios",value:function(e,t,i){console.log("Performing axios call: "+e),t.loading=!0,t.error={message:"",visible:!1},i().catch((function(e){return t.handleError(e)})).finally((function(){console.log("Finished axios call: "+e),t.loading=!1}))}}]),e}()),w={name:"Options",props:{ctx:Object},data:function(){return{uploadForm:{file:null,tags:""},error:{message:"",visible:!1},loading:!1}},methods:{logout:function(){this.$emit("logout")},permissions:function(){this.$emit("permissions")},close:function(){this.$emit("close")},upload:function(){var e=this;if(this.uploadForm.file)if(this.uploadForm.file.size>1048576)this.error={message:"The file is too big. Max 1MB.",visible:!0};else{var t=new FormData;t.append("tags",this.uploadForm.tags),t.append("file",this.uploadForm.file),x.loadWithAxios("import CSV",this,(function(){return e.ctx.axios.post("items/import",t,{"Content-Type":"multipart/form-data"}).then((function(t){e.error={message:t.data.error,visible:!!t.data.error},t.data.error||e.$emit("items-uploaded")}))}))}else this.error={message:"Select a file",visible:!0}},handleError:function(e){console.error("Error: "+e),this.error={message:e,visible:!0}}}},I=w,_=(i("4dcb"),i("0798")),V=i("40dc"),k=i("8336"),F=i("b0af"),L=i("a523"),S=i("ce7e"),P=i("23a7"),C=i("132d"),T=i("f6c4"),E=i("490a"),$=i("2fa4"),O=i("8654"),A=i("2a7f"),j=Object(o["a"])(I,h,g,!1,null,"4595c0c0",null),D=j.exports;l()(j,{VAlert:_["a"],VAppBar:V["a"],VBtn:k["a"],VCard:F["a"],VContainer:L["a"],VDivider:S["a"],VFileInput:P["a"],VIcon:C["a"],VMain:T["a"],VProgressCircular:E["a"],VSpacer:$["a"],VTextField:O["a"],VToolbarTitle:A["a"]});var M=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Secured",{ref:"secured",attrs:{bypass:e.ctx.viewingSharedLink},on:{"credentials-changed":e.updateCredentials}},[e.displayMain?i("Main",{ref:"main",attrs:{ctx:e.ctx},on:{logout:e.logout}}):e._e()],1)},B=[],R=(i("ac1f"),i("841c"),i("1276"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"fixed-div"},[i("ItemList",{ref:"itemList",staticClass:"fixed-div",style:e.styleForView(this.views.ItemList),attrs:{ctx:e.ctx},on:{"open-item":e.openItem,"add-item":e.addItem,options:e.options,permissions:e.displayPermissionList}}),i("ItemEdit",{ref:"editItem",staticClass:"fixed-div",style:e.styleForView(this.views.ItemEdit),attrs:{ctx:e.ctx},on:{updated:e.itemUpdated,created:e.itemCreated,deleted:e.itemDeleted,canceled:e.displayList,"display-tags":e.displayTags}}),i("Options",{staticClass:"fixed-div",style:e.styleForView(this.views.Options),attrs:{ctx:e.ctx},on:{"items-uploaded":e.refreshItemList,close:e.displayList,permissions:e.permissions,logout:e.logout}}),i("PermissionList",{ref:"permissionList",staticClass:"fixed-div",style:e.styleForView(this.views.PermissionList),attrs:{ctx:e.ctx},on:{"open-permission":e.openPermission,"add-permission":e.addPermission,close:e.displayList}}),i("PermissionEdit",{ref:"editPermission",staticClass:"fixed-div",style:e.styleForView(this.views.PermissionEdit),attrs:{ctx:e.ctx},on:{updated:e.permissionUpdated,created:e.permissionCreated,deleted:e.permissionDeleted,canceled:e.displayPermissionList}})],1)}),U=[],q=(i("b0c0"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"editDiv"}},[i("v-app-bar",{attrs:{app:"",dark:""}},[i("v-toolbar-title",[e._v(e._s(e.title))]),e.loading?i("v-progress-circular",{staticClass:"load-progress",attrs:{width:3,size:20,indeterminate:"",color:"primary"}}):e._e(),i("v-spacer"),e.isDataCorrect&&!e.readonly?i("v-btn",{attrs:{icon:""},on:{click:e.saveItem}},[i("v-icon",[e._v("mdi-content-save")])],1):e._e(),i("v-btn",{attrs:{icon:""},on:{click:e.cancel}},[i("v-icon",[e._v("mdi-close")])],1)],1),i("v-main",[i("v-card",{attrs:{flat:"",tile:""}},[i("v-container",[i("v-alert",{attrs:{color:"red",dismissible:"",type:"error"},model:{value:e.error.visible,callback:function(t){e.$set(e.error,"visible",t)},expression:"error.visible"}},[e._v(e._s(e.error.message))])],1),i("v-container",[i("v-text-field",{attrs:{readonly:e.readonly,label:"Title"},model:{value:e.itemForm.title,callback:function(t){e.$set(e.itemForm,"title",t)},expression:"itemForm.title"}}),i("v-text-field",{attrs:{readonly:e.readonly,label:"Url","append-outer-icon":e.itemForm.url?"mdi-open-in-new":"","append-icon":e.itemForm.url?"mdi-cloud-download":""},on:{"click:append-outer":e.openUrl,"click:append":e.getMetadataFromUrl},model:{value:e.itemForm.url,callback:function(t){e.$set(e.itemForm,"url",t)},expression:"itemForm.url"}}),i("v-text-field",{attrs:{readonly:e.readonly,label:"Image url","append-icon":e.itemForm.image?"mdi-open-in-new":""},on:{"click:append":e.openImage},model:{value:e.itemForm.image,callback:function(t){e.$set(e.itemForm,"image",t)},expression:"itemForm.image"}}),i("v-textarea",{attrs:{readonly:e.readonly,label:"Notes","auto-grow":"",rows:"1"},model:{value:e.itemForm.notes,callback:function(t){e.$set(e.itemForm,"notes",t)},expression:"itemForm.notes"}}),i("v-text-field",{attrs:{readonly:e.readonly,label:"Tags","append-icon":e.itemForm.tags?"mdi-eye":""},on:{"click:append":e.openTags},model:{value:e.itemForm.tags,callback:function(t){e.$set(e.itemForm,"tags",t)},expression:"itemForm.tags"}}),i("v-container"),i("v-slider",{attrs:{readonly:e.readonly,label:"Score",color:e.sliderColor,"thumb-label":"always",min:"0",max:"100"},model:{value:e.itemForm.score,callback:function(t){e.$set(e.itemForm,"score",t)},expression:"itemForm.score"}})],1)],1),i("v-divider"),i("v-card",{attrs:{flat:"",tile:""}},[i("v-container",[e.isEditing&&!e.readonly?i("v-btn",{attrs:{color:"error",elevation:"2"},on:{click:e.deleteItem}},[e._v(" Delete "),i("v-icon",{attrs:{right:""}},[e._v("mdi-delete")])],1):e._e()],1)],1)],1)],1)}),W=[],z=(i("498a"),i("4de4"),{name:"ItemEdit",props:{ctx:Object},data:function(){return{itemForm:{},item:null,error:{message:"",visible:!1},loading:!1}},computed:{readonly:function(){return this.ctx.viewingSharedLink},sliderColor:function(){return x.colorFromScore(this.itemForm.score)},isEditing:function(){return null!=this.item},isDataCorrect:function(){return this.itemForm.title&&this.itemForm.title.trim()},title:function(){return this.readonly?"View Item":this.isEditing?"Edit Item":"Create Item"}},methods:{setItem:function(e){console.log("EditItem:",e?e.title:"(new item)"),this.error={message:"",visible:!1},this.item=e,this.itemForm=this.itemToForm(this.item),this.scrollToTop()},scrollToTop:function(){document.getElementById("editDiv").scrollTop=0},cancel:function(){this.$emit("canceled")},deleteItem:function(){var e=this;x.loadWithAxios("delete item",this,(function(){return e.ctx.axios.post("items/deleteOne",{id:e.item.id}).then((function(){e.$emit("deleted",e.item)}))}))},saveItem:function(){var e=this,t=this.formToItem(this.itemForm);x.loadWithAxios("upsert item",this,(function(){return e.ctx.axios.post("items/upsertOne",t).then((function(t){e.isEditing?e.$emit("updated",{newItem:t.data,oldItem:e.item}):e.$emit("created",t.data)}))}))},handleError:function(e){this.error=x.messageObjectFromApiError(e),this.scrollToTop()},openUrl:function(){var e=this.itemForm.url;e&&window.open(e)},getMetadataFromUrl:function(){var e=this;console.log("Getting metadata from url: "+this.itemForm.url);var t=this.itemForm.url;t&&x.loadWithAxios("metadata from url",this,(function(){return e.ctx.axios.post("metadata/getFromUrl",{url:e.itemForm.url}).then((function(t){var i=t.data;i&&(e.itemForm=e.itemToForm(i))}))}))},openImage:function(){var e=this.itemForm.image;e&&window.open(e)},openTags:function(){var e=this.parseFormTags(this.itemForm.tags);this.$emit("display-tags",e)},formToItem:function(e){return{id:e.id,userId:e.userId,title:e.title,url:e.url,image:e.image,notes:e.notes,tags:this.parseFormTags(e.tags),score:e.score}},parseFormTags:function(e){return e.trim().split(/[, ]+/).filter((function(e){return!!e}))},itemToForm:function(e){return e?{id:e.id,userId:e.userId,title:e.title,url:e.url,image:e.image,notes:e.notes,tags:e.tags.join(" "),score:e.score}:{id:null,userId:null,title:"",url:"",image:"",notes:"",tags:"",score:50}}}}),N=z,J=(i("0c5f"),i("ba0d")),H=i("a844"),G=Object(o["a"])(N,q,W,!1,null,"227b85dc",null),Q=G.exports;l()(G,{VAlert:_["a"],VAppBar:V["a"],VBtn:k["a"],VCard:F["a"],VContainer:L["a"],VDivider:S["a"],VIcon:C["a"],VMain:T["a"],VProgressCircular:E["a"],VSlider:J["a"],VSpacer:$["a"],VTextField:O["a"],VTextarea:H["a"],VToolbarTitle:A["a"]});var Z=function(){var e=this,t=this,i=t.$createElement,s=t._self._c||i;return s("div",{attrs:{id:"listDiv"}},[s("v-app-bar",{attrs:{app:"",dark:""}},[s("v-toolbar-title",[t._v("Item List")]),s("div",[s("span",{staticStyle:{"margin-left":"10px","font-size":"75%"}},[t._v(" "+t._s(t.itemCount)+" ")])]),t.loading?s("v-progress-circular",{staticClass:"load-progress",attrs:{width:3,size:20,indeterminate:"",color:"primary"}}):t._e(),s("v-spacer"),s("v-menu",{attrs:{left:"",bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on,r=e.attrs;return[s("v-btn",t._g(t._b({attrs:{icon:""}},"v-btn",r,!1),i),[s("v-icon",[t._v("mdi-sort")])],1)]}}])},[s("v-list",[s("v-list-item",{on:{click:function(){return e.sortItemsWith({property:"title",direction:1})}}},[s("v-list-item-title",[t._v("By title A-Z")])],1),s("v-list-item",{on:{click:function(){return e.sortItemsWith({property:"title",direction:-1})}}},[s("v-list-item-title",[t._v("By title Z-A")])],1),s("v-list-item",{on:{click:function(){return e.sortItemsWith({property:"score",direction:1})}}},[s("v-list-item-title",[t._v("By score 0-100")])],1),s("v-list-item",{on:{click:function(){return e.sortItemsWith({property:"score",direction:-1})}}},[s("v-list-item-title",[t._v("By score 100-0")])],1)],1)],1),t.ctx.credentials?s("v-btn",{attrs:{icon:""},on:{click:t.options}},[s("v-icon",[t._v("mdi-cog")])],1):t._e(),t.ctx.viewingSharedLink?t._e():s("v-btn",{attrs:{icon:""},on:{click:t.addItem}},[s("v-icon",[t._v("mdi-plus")])],1)],1),s("v-main",[s("v-card",{attrs:{flat:"",tile:"",dark:""}},[t.ctx.viewingSharedLink?s("v-container",[s("v-alert",{attrs:{dismissible:"",type:"info"}},[t._v(" Viewing items from user "),s("strong",[t._v(t._s(t.ctx.search.username))]),t._v(" with tags "),s("strong",[t._v(t._s(t.ctx.search.tags.join(", ")))]),t._v(". ")]),t.ctx.viewingMyItems?s("a",{attrs:{href:"#"},on:{click:t.goToPermissions}},[t._v("Edit permissions to allow access")]):t._e()],1):t._e(),s("v-container",[s("v-alert",{attrs:{color:"red",dismissible:"",type:"error"},model:{value:t.error.visible,callback:function(e){t.$set(t.error,"visible",e)},expression:"error.visible"}},[t._v(t._s(t.error.message))])],1),s("v-container",[s("v-text-field",{attrs:{clearable:"",label:"Search",placeholder:"Search words or #tags","prepend-inner-icon":"mdi-pound-box"},on:{"click:prepend-inner":t.addHashChar},model:{value:t.query,callback:function(e){t.query=e},expression:"query"}}),t.shareable?s("div",[t._v(" Share link: "),s("a",{attrs:{href:t.shareLink(),target:"_blank"}},[t._v(" "+t._s(t.shareLink()))])]):t._e()],1),s("v-list",t._l(t.searchedItems,(function(e){return s("v-list-item",{key:e.id,on:{click:function(i){return t.openItem(e)}}},[s("ItemListItem",{attrs:{item:e}})],1)})),1)],1),s("v-btn",{staticStyle:{"z-index":"3",position:"fixed",right:"20px",bottom:"20px"},attrs:{elevation:"2"},on:{click:t.scrollToTop}},[s("v-icon",[t._v("mdi-chevron-double-up")])],1)],1)],1)},K=[],X=i("b85c"),Y=(i("a434"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-list-item-content",[i("v-list-item-title",[e._v(" "+e._s(e.item.title)+" ")]),i("v-list-item-subtitle",[e._v(" "+e._s(e.subtitle)+" ")]),i("v-list-item-subtitle",{staticStyle:{color:"#6d6d6d"}},[e._v(" "+e._s(e.subtitle2)+" ")]),i("v-progress-linear",{attrs:{height:"1",color:e.colorForItem(e.item),value:e.item.score}})],1)}),ee=[],te={name:"ItemListItem",props:{item:Object},computed:{subtitle:function(){return this.item.notes},subtitle2:function(){return x.getTagsString(this.item)}},methods:{colorForItem:function(e){return x.colorFromScore(e.score)}}},ie=te,se=i("5d23"),re=i("8e36"),ne=Object(o["a"])(ie,Y,ee,!1,null,null,null),oe=ne.exports;l()(ne,{VListItemContent:se["a"],VListItemSubtitle:se["b"],VListItemTitle:se["c"],VProgressLinear:re["a"]});var ae=i("e9b9"),le=i("1a2d"),ce={name:"ItemList",components:{ItemListItem:oe},props:{ctx:Object},created:function(){this.setupObserverForRefreshSearchedItems(),this.retrieveItemsFromApi()},watch:{lowerSearch:function(){this.sendRefreshSearchedItems()}},data:function(){return{query:"",items:[],searchedItems:[],error:{message:"",visible:!1},loading:!1,sort:{property:"title",direction:1}}},computed:{lowerSearch:function(){return this.query?this.query.trim().toLowerCase():""},shareable:function(){return!!this.ctx.viewingMyItems&&("#"===this.lowerSearch[0]&&(0!==this.searchedItems.length&&0===this.lowerSearch.split(/ +/).filter((function(e){return"#"!==e[0]})).length))},itemCount:function(){return this.lowerSearch?this.searchedItems.length+" of "+this.items.length:this.items.length}},methods:{setupObserverForRefreshSearchedItems:function(){var e=this,t=this;new ae["a"]((function(t){e.subscriber=t})).pipe(Object(le["a"])(500)).subscribe({next:function(e){t.refreshSearchedItems(e)},error:function(e){console.error("something wrong occurred: "+e)},complete:function(){console.log("done")}})},addHashChar:function(){console.log("#"),this.query?this.query+=" #":this.query="#"},retrieveItemsFromApi:function(){var e=this;console.log("Loading items from API",this.ctx.search);var t=this.ctx.search;x.loadWithAxios("get items",this,(function(){return e.ctx.axios.post("items/search",t).then((function(t){return e.prepareItems(t.data)}))}))},prepareItems:function(e){console.log("Preparing items",e),this.fillRawContent(e.items),this.sortAndSetItems(e.items)},sortItemsWith:function(e){this.sort=e,this.sortAndSetItems(this.items)},sortAndSetItems:function(e){var t=this,i=this.sort.property,s=function(e,s){return e[i]<s[i]?-t.sort.direction:e[i]>s[i]?t.sort.direction:0};e.sort(s);for(var r=0;r<e.length;r++)e[r].index=r;this.items=e,this.sendRefreshSearchedItems()},sendRefreshSearchedItems:function(){this.subscriber.next(this.lowerSearch)},refreshSearchedItems:function(e){console.log("Searching",e),e||(this.searchedItems=this.items);var t=e.split(/ +/).map((function(e){return"#"===e[0]?e+" ":e}));this.searchedItems=this.items.filter((function(e){var i,s=Object(X["a"])(t);try{for(s.s();!(i=s.n()).done;){var r=i.value;if(e.rawContent.indexOf(r)<0)return!1}}catch(n){s.e(n)}finally{s.f()}return!0}))},fillRawContent:function(e){var t,i=Object(X["a"])(e);try{for(i.s();!(t=i.n()).done;){var s=t.value;x.fillItemRawContent(s)}}catch(r){i.e(r)}finally{i.f()}},addItem:function(){this.$emit("add-item")},openItem:function(e){this.$emit("open-item",e)},itemUpdated:function(e){x.fillItemRawContent(e.newItem),this.items[e.oldItem.index]=e.newItem,this.sortAndSetItems(this.items)},itemAdded:function(e){x.fillItemRawContent(e),this.items.push(e),this.sortAndSetItems(this.items)},itemDeleted:function(e){this.items.splice(e,1),this.sortAndSetItems(this.items)},applyQuery:function(e){this.query=e},refreshItems:function(){this.retrieveItemsFromApi()},scrollToTop:function(){document.getElementById("listDiv").scrollTop=0},options:function(){this.$emit("options")},goToPermissions:function(){this.$emit("permissions")},openShareLink:function(){window.open(this.shareLink())},shareLink:function(){var e=this.lowerSearch.split(/ +/).map((function(e){return e.substr(1)}));return x.buildShareLink(e,this.ctx)},handleError:function(e){this.error=x.messageObjectFromApiError(e),this.scrollToTop()}}},me=ce,de=(i("edfc"),i("8860")),ue=i("da13"),pe=i("e449"),fe=Object(o["a"])(me,Z,K,!1,null,"6d2aa260",null),ve=fe.exports;l()(fe,{VAlert:_["a"],VAppBar:V["a"],VBtn:k["a"],VCard:F["a"],VContainer:L["a"],VIcon:C["a"],VList:de["a"],VListItem:ue["a"],VListItemTitle:se["c"],VMain:T["a"],VMenu:pe["a"],VProgressCircular:E["a"],VSpacer:$["a"],VTextField:O["a"],VToolbarTitle:A["a"]});var he=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"listDiv"}},[i("v-app-bar",{attrs:{app:"",dark:""}},[i("v-toolbar-title",[e._v("Permissions")]),i("div",[i("span",{staticStyle:{"margin-left":"10px","font-size":"75%"}},[e._v(" "+e._s(e.permissionCount)+" ")])]),i("v-spacer"),i("v-btn",{attrs:{icon:""},on:{click:e.close}},[i("v-icon",[e._v("mdi-close")])],1),i("v-btn",{attrs:{icon:""},on:{click:e.addPermission}},[i("v-icon",[e._v("mdi-plus")])],1)],1),i("v-main",[i("v-card",{attrs:{flat:"",tile:"",dark:""}},[i("v-container",[i("v-alert",{attrs:{color:"red",dismissible:"",type:"error"},model:{value:e.error.visible,callback:function(t){e.$set(e.error,"visible",t)},expression:"error.visible"}},[e._v(e._s(e.error.message))])],1),i("v-container",[i("v-text-field",{attrs:{clearable:"",label:"Search"},model:{value:e.query,callback:function(t){e.query=t},expression:"query"}})],1),i("v-list",e._l(e.searchedPermissions,(function(t){return i("v-list-item",{key:t.id,on:{click:function(i){return e.openPermission(t)}}},[i("PermissionListItem",{attrs:{permission:t}})],1)})),1)],1),i("v-btn",{staticStyle:{"z-index":"3",position:"fixed",right:"20px",bottom:"20px"},attrs:{elevation:"2"},on:{click:e.scrollToTop}},[i("v-icon",[e._v("mdi-chevron-double-up")])],1)],1)],1)},ge=[],be=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-list-item-content",[i("v-list-item-title",[e._v(" "+e._s(e.title)+" ")]),i("v-list-item-subtitle",[e._v(" "+e._s(e.subtitle)+" ")]),i("v-progress-linear",{attrs:{height:"1",color:"grey darken-3",value:"100"}})],1)},ye=[],xe={name:"PermissionListItem",props:{permission:Object},computed:{title:function(){return this.permission.tags.join(" ")},subtitle:function(){return 0===this.permission.usernames.length?"(all users)":this.permission.usernames.join(" ")}}},we=xe,Ie=Object(o["a"])(we,be,ye,!1,null,null,null),_e=Ie.exports;l()(Ie,{VListItemContent:se["a"],VListItemSubtitle:se["b"],VListItemTitle:se["c"],VProgressLinear:re["a"]});var Ve={name:"PermissionList",components:{PermissionListItem:_e},props:{ctx:Object},created:function(){this.retrievePermissionsFromApi()},data:function(){return{query:null,permissions:[],error:{message:"",visible:!1}}},computed:{lowerSearch:function(){return this.query?this.query.trim().toLowerCase():""},searchedPermissions:function(){if(!this.lowerSearch)return this.permissions;var e=this.lowerSearch.split(/ +/).map((function(e){return"#"===e[0]?e+" ":e}));return this.permissions.filter((function(t){var i,s=Object(X["a"])(e);try{for(s.s();!(i=s.n()).done;){var r=i.value;if(t.rawContent.indexOf(r)<0)return!1}}catch(n){s.e(n)}finally{s.f()}return!0}))},permissionCount:function(){return this.lowerSearch?this.searchedPermissions.length+" of "+this.permissions.length:this.permissions.length}},methods:{retrievePermissionsFromApi:function(){var e=this;console.log("Loading permissions from API",this.ctx.search),this.ctx.axios.post("permissions/search").then((function(t){return e.preparePermissions(t.data)})).catch((function(t){return e.handleError(t)}))},preparePermissions:function(e){console.log("Preparing permissions",e),this.fillRawContent(e.permissions),this.sortAndSetPermissions(e.permissions)},sortAndSetPermissions:function(e){var t=function(e,t){return e.rawContent<t.rawContent?-1:e.rawContent>t.rawContent?1:0};e.sort(t);for(var i=0;i<e.length;i++)e[i].index=i;this.permissions=e},fillRawContent:function(e){var t,i=Object(X["a"])(e);try{for(i.s();!(t=i.n()).done;){var s=t.value;x.fillPermissionRawContent(s)}}catch(r){i.e(r)}finally{i.f()}},addPermission:function(){this.$emit("add-permission")},openPermission:function(e){this.$emit("open-permission",e)},permissionUpdated:function(e){x.fillPermissionRawContent(e.newPermission),this.permissions[e.oldPermission.index]=e.newPermission,this.sortAndSetPermissions(this.permissions)},permissionAdded:function(e){x.fillPermissionRawContent(e),this.permissions.push(e),this.sortAndSetPermissions(this.permissions)},permissionDeleted:function(e){this.permissions.splice(e,1),this.sortAndSetPermissions(this.permissions)},refreshPermissions:function(){this.retrievePermissionsFromApi()},scrollToTop:function(){document.getElementById("listDiv").scrollTop=0},close:function(){this.$emit("close")},handleError:function(e){this.error=x.messageObjectFromApiError(e),this.scrollToTop()}}},ke=Ve,Fe=Object(o["a"])(ke,he,ge,!1,null,null,null),Le=Fe.exports;l()(Fe,{VAlert:_["a"],VAppBar:V["a"],VBtn:k["a"],VCard:F["a"],VContainer:L["a"],VIcon:C["a"],VList:de["a"],VListItem:ue["a"],VMain:T["a"],VSpacer:$["a"],VTextField:O["a"],VToolbarTitle:A["a"]});var Se=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"editDiv"}},[i("v-app-bar",{attrs:{app:"",dark:""}},[i("v-toolbar-title",[e._v("Edit Permission")]),i("v-spacer"),e.isDataCorrect?i("v-btn",{attrs:{icon:""},on:{click:e.savePermission}},[i("v-icon",[e._v("mdi-content-save")])],1):e._e(),i("v-btn",{attrs:{icon:""},on:{click:e.cancel}},[i("v-icon",[e._v("mdi-close")])],1)],1),i("v-main",[i("v-card",{attrs:{flat:"",tile:""}},[i("v-container",[i("v-alert",{attrs:{color:"red",dismissible:"",type:"error"},model:{value:e.error.visible,callback:function(t){e.$set(e.error,"visible",t)},expression:"error.visible"}},[e._v(e._s(e.error.message))])],1),i("v-container",[i("v-text-field",{attrs:{label:"Tags"},model:{value:e.permissionForm.tags,callback:function(t){e.$set(e.permissionForm,"tags",t)},expression:"permissionForm.tags"}}),e.isDataCorrect?i("div",[e._v(" Share link: "),i("a",{attrs:{href:e.shareLink(),target:"_blank"}},[e._v(" "+e._s(e.shareLink()))])]):e._e(),i("v-text-field",{attrs:{label:"Allowed usernames",placeholder:"Leave empty to allow access to all users"},model:{value:e.permissionForm.usernames,callback:function(t){e.$set(e.permissionForm,"usernames",t)},expression:"permissionForm.usernames"}})],1)],1),i("v-divider"),i("v-card",{attrs:{flat:"",tile:""}},[i("v-container",[e.isEditing?i("v-btn",{attrs:{color:"error",elevation:"2"},on:{click:e.deletePermission}},[e._v(" Delete "),i("v-icon",{attrs:{right:""}},[e._v("mdi-delete")])],1):e._e()],1)],1)],1)],1)},Pe=[],Ce={name:"PermissionEdit",props:{ctx:Object},data:function(){return{permissionForm:{},permission:null,error:{message:"",visible:!1}}},computed:{isEditing:function(){return null!=this.permission},isDataCorrect:function(){return this.permissionForm.tags&&this.permissionForm.tags.trim()}},methods:{setPermission:function(e){this.error={message:"",visible:!1},this.permission=e,this.permissionForm=this.permissionToForm(this.permission),this.scrollToTop()},scrollToTop:function(){document.getElementById("editDiv").scrollTop=0},cancel:function(){this.$emit("canceled")},deletePermission:function(){var e=this;this.ctx.axios.post("permissions/deleteOne",{id:this.permission.id}).then((function(){e.$emit("deleted",e.permission)})).catch((function(t){return e.handleError(t)}))},savePermission:function(){var e=this,t=this.formToPermission(this.permissionForm);this.ctx.axios.post("permissions/upsertOne",t).then((function(t){e.isEditing?e.$emit("updated",{newPermission:t.data,oldPermission:e.permission}):e.$emit("created",t.data)})).catch((function(t){return e.handleError(t)}))},shareLink:function(){var e=this.formToPermission(this.permissionForm);return x.buildShareLink(e.tags,this.ctx)},handleError:function(e){this.error=x.messageObjectFromApiError(e),this.scrollToTop()},formToPermission:function(e){return{id:e.id,userId:e.userId,usernames:e.usernames.trim().split(/[, ]+/).filter((function(e){return!!e})),tags:e.tags.trim().split(/[, ]+/).filter((function(e){return!!e}))}},permissionToForm:function(e){return e?{id:e.id,userId:e.userId,usernames:e.usernames.join(" "),tags:e.tags.join(" ")}:{id:null,userId:null,usernames:"",tags:""}}}},Te=Ce,Ee=Object(o["a"])(Te,Se,Pe,!1,null,null,null),$e=Ee.exports;l()(Ee,{VAlert:_["a"],VAppBar:V["a"],VBtn:k["a"],VCard:F["a"],VContainer:L["a"],VDivider:S["a"],VIcon:C["a"],VMain:T["a"],VSpacer:$["a"],VTextField:O["a"],VToolbarTitle:A["a"]});var Oe={name:"Main",components:{PermissionEdit:$e,ItemList:ve,ItemEdit:Q,Options:D,PermissionList:Le},props:{ctx:Object},created:function(){this.currentView=this.views.ItemList},data:function(){return{views:{ItemList:"ItemList",ItemEdit:"ItemEdit",Options:"Options",PermissionList:"PermissionList",PermissionEdit:"PermissionEdit"},currentView:null}},methods:{addItem:function(){this.displayItemEdit(null)},openItem:function(e){console.log("Main: open item",e.id,e.title),this.displayItemEdit(e)},displayItemEdit:function(e){var t=this;this.$refs.editItem.setItem(e),setTimeout((function(){t.currentView=t.views.ItemEdit}),300)},itemUpdated:function(e){console.log("Main: item updated",e),this.$refs.itemList.itemUpdated(e),this.displayList()},itemCreated:function(e){console.log("Main: item created",e.title),this.$refs.itemList.itemAdded(e),this.displayList()},itemDeleted:function(e){console.log("Main: item deleted",e.id,e.index,e.title),this.$refs.itemList.itemDeleted(e.index),this.displayList()},refreshItemList:function(){this.$refs.itemList.refreshItems(),this.displayList()},displayList:function(){this.currentView=this.views.ItemList},displayTags:function(e){var t=e.map((function(e){return"#"+e})).join(" ");this.$refs.itemList.applyQuery(t),this.displayList()},addPermission:function(){this.displayPermissionEdit(null)},openPermission:function(e){console.log("Main: open permission",e.id,e.tags),this.displayPermissionEdit(e)},displayPermissionEdit:function(e){var t=this;this.$refs.editPermission.setPermission(e),setTimeout((function(){t.currentView=t.views.PermissionEdit}),300)},permissionUpdated:function(e){console.log("Main: permission updated",e),this.$refs.permissionList.permissionUpdated(e),this.displayPermissionList()},permissionCreated:function(e){console.log("Main: permission created",e.tags),this.$refs.permissionList.permissionAdded(e),this.displayPermissionList()},permissionDeleted:function(e){console.log("Main: permission deleted",e.id,e.index,e.tags),this.$refs.permissionList.permissionDeleted(e.index),this.displayPermissionList()},refreshPermissionList:function(){this.$refs.permissionList.refreshPermissions(),this.displayPermissionList()},displayPermissionList:function(){this.currentView=this.views.PermissionList},handleError:function(e){console.error("API Error",e)},onNavigation:function(e,t){console.log("Tried to navigate from "+t.name+" to "+e.name),this.currentView===this.views.ItemList?this.ctx.viewingSharedLink&&(location.href="/"):this.displayList()},styleForView:function(e){return{zIndex:this.currentView===e?2:1}},options:function(){this.currentView=this.views.Options},permissions:function(){this.currentView=this.views.PermissionList},logout:function(){this.$emit("logout")}}},Ae=Oe,je=(i("6fa9"),Object(o["a"])(Ae,R,U,!1,null,"53e417fc",null)),De=je.exports,Me=i("bc3a"),Be=i.n(Me),Re=s["a"].config.devtools;console.log("Development mode?",Re);var Ue={apiUrl:Re?"http://localhost:8070/":""},qe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.credentials||e.bypass?i("div",[e._t("default")],2):i("div",[i("Login",{on:{login:e.login}})],1)},We=[],ze=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-app-bar",{attrs:{app:"",dark:""}},[i("v-toolbar-title",[e._v("Login")]),e.loading?i("v-progress-circular",{staticClass:"load-progress",attrs:{width:3,size:20,indeterminate:"",color:"primary"}}):e._e(),i("v-spacer"),i("v-btn",{attrs:{icon:""},on:{click:function(t){return e.loginOrRegister()}}},[i("v-icon",[e._v("mdi-login")])],1)],1),i("v-main",[i("v-card",{attrs:{flat:"",tile:"",dark:""}},[i("v-container",[i("v-alert",{attrs:{color:"red",dismissible:"",type:"error"},model:{value:e.error.visible,callback:function(t){e.$set(e.error,"visible",t)},expression:"error.visible"}},[e._v(e._s(e.error.message))]),i("v-alert",{attrs:{dismissible:"",type:"info"},model:{value:e.info.visible,callback:function(t){e.$set(e.info,"visible",t)},expression:"info.visible"}},[e._v(e._s(e.info.message))])],1),i("v-container",[i("v-text-field",{attrs:{label:"username","auto-grow":"",rows:"1"},model:{value:e.loginData.username,callback:function(t){e.$set(e.loginData,"username",t)},expression:"loginData.username"}}),i("v-text-field",{attrs:{type:"password",label:"password","auto-grow":"",rows:"1"},model:{value:e.loginData.password,callback:function(t){e.$set(e.loginData,"password",t)},expression:"loginData.password"}}),i("v-text-field",{attrs:{type:"password",label:"repeat password to register","auto-grow":"",rows:"1"},model:{value:e.loginData.password2,callback:function(t){e.$set(e.loginData,"password2",t)},expression:"loginData.password2"}})],1)],1)],1)],1)},Ne=[],Je={name:"Login",data:function(){return{loginData:{username:"",password:"",password2:""},error:{visible:!1},info:{visible:!1},loading:!1}},methods:{loginOrRegister:function(){var e,t=this;if(this.loginData.password2){if(this.loginData.password!==this.loginData.password2)return void(this.error={message:"Passwords don't match",visible:!0});e="register"}else e="login";console.log("Login: ",e),x.loadWithAxios("login",this,(function(){return Be.a.post(Ue.apiUrl+"/security/"+e,t.loginData).then((function(e){return t.handleCredentials(e.data)}))}))},handleCredentials:function(e){this.$emit("login",e)},handleError:function(e){this.error=x.messageObjectFromApiError(e)}}},He=Je,Ge=(i("1d4b"),Object(o["a"])(He,ze,Ne,!1,null,"5960b65f",null)),Qe=Ge.exports;l()(Ge,{VAlert:_["a"],VAppBar:V["a"],VBtn:k["a"],VCard:F["a"],VContainer:L["a"],VIcon:C["a"],VMain:T["a"],VProgressCircular:E["a"],VSpacer:$["a"],VTextField:O["a"],VToolbarTitle:A["a"]});var Ze=i("a78e"),Ke=i.n(Ze),Xe={name:"Secured",components:{Login:Qe},created:function(){this.reloadCredentials()},props:{bypass:Boolean},data:function(){return{credentials:null,message:"debug message"}},methods:{login:function(e){console.log("Secured: storing cookies for credentials"),this.message+=", storing cookies for credentials";var t=JSON.stringify(e);Ke.a.set("credentials",t,{sameSite:"strict",expires:30}),this.updateCredentials(e)},logout:function(){this.removeCredentials()},removeCredentials:function(){console.log("Secured: removing credentials"),Ke.a.remove("credentials"),this.updateCredentials(null)},reloadCredentials:function(){console.log("Secured: reloading credentials"),this.message+=", reloading credentials";var e=Ke.a.get("credentials");e?(console.log("Secured: credentials found"),this.message+=", credentials found",this.updateCredentials(JSON.parse(e))):(console.log("Secured: credentials not found"),this.message+=", credentials NOT found",this.removeCredentials())},updateCredentials:function(e){console.log("Secured: updating credentials"),this.credentials=e,this.$emit("credentials-changed",e)}}},Ye=Xe,et=Object(o["a"])(Ye,qe,We,!1,null,null,null),tt=et.exports,it={name:"AppStart",components:{Secured:tt,Main:De},data:function(){return{ctx:{},displayMain:!1}},created:function(){},methods:{updateCredentials:function(e){console.log("Main: update credentials",e);var t=this.createSearchFromSharedLink();this.ctx.viewingSharedLink=null!==t,this.ctx.credentials=e,this.ctx.axios=this.createAxiosInstance(e);var i=e||this.ctx.viewingSharedLink;i?(this.ctx.search=t||{username:e.username},this.ctx.viewingMyItems=e&&e.username===this.ctx.search.username,this.displayMain=!0):this.displayMain=!1},createSearchFromSharedLink:function(){var e=window.location.search;if(!e)return null;var t=new URLSearchParams(e);return{username:t.get("user"),tags:t.get("tags").split(",")}},createAxiosInstance:function(e){console.log("Creating axios instance");var t={baseURL:Ue.apiUrl};return e&&(t.headers={Authorization:"Bearer "+e.token}),Be.a.create(t)},logout:function(){this.$refs.secured.logout(),location.href="/"}},beforeRouteLeave:function(e,t,i){console.log("Navigation intercepted"),i(!1),this.displayMain&&this.$refs.main.onNavigation(e,t)}},st=it,rt=Object(o["a"])(st,M,B,!1,null,null,null),nt=rt.exports,ot=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("SampleComponent")},at=[],lt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-app-bar",{attrs:{app:"",dark:""}},[i("v-toolbar-title",[e._v(e._s(e.title))]),i("v-spacer"),i("v-btn",{attrs:{icon:""},on:{click:e.method}},[i("v-icon",[e._v("mdi-cog")])],1)],1),i("v-main",[i("v-card",{attrs:{flat:"",tile:"",dark:""}},[i("v-container",[e._v(" "+e._s(e.message)+" ")])],1)],1)],1)},ct=[],mt={name:"SampleComponent",props:{ctx:Object},created:function(){this.message="Component created"},data:function(){return{title:"Sample component",message:null}},methods:{method:function(){var e=x.colorFromScore(75);console.log("Color: "+e)}}},dt=mt,ut=Object(o["a"])(dt,lt,ct,!1,null,null,null),pt=ut.exports;l()(ut,{VAppBar:V["a"],VBtn:k["a"],VCard:F["a"],VContainer:L["a"],VIcon:C["a"],VMain:T["a"],VSpacer:$["a"],VToolbarTitle:A["a"]});var ft={name:"SampleView",components:{SampleComponent:pt},beforeRouteLeave:function(e,t,i){console.log("Going back"),"A"===t.name&&"B"===e.name?i():i(!1)}},vt=ft,ht=Object(o["a"])(vt,ot,at,!1,null,null,null),gt=ht.exports;s["a"].use(v["a"]);var bt=[{path:"/",name:"AppStart",component:nt},{path:"/sample",name:"SampleView",component:gt},{path:"/options",name:"Options",component:D}],yt=new v["a"]({mode:"history",base:"/",routes:bt}),xt=yt;s["a"].config.productionTip=!1,new s["a"]({vuetify:f,router:xt,render:function(e){return e(u)}}).$mount("#app")},"5c0b":function(e,t,i){"use strict";i("9c0c")},"6fa9":function(e,t,i){"use strict";i("0d00")},"8bb8":function(e,t,i){},"9c0c":function(e,t,i){},edfc:function(e,t,i){"use strict";i("ef2f")},ef2f:function(e,t,i){}});
//# sourceMappingURL=app.b1beaff7.js.map